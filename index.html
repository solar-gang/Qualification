<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eligibility Request | Net Billing (NEM 3.0)</title>

<style>
  :root{
    --bg:#0b1220;
    --card:#101a30;
    --text:#eef3ff;
    --muted:#b8c4df;
    --line:rgba(255,255,255,.12);

    /* Notice look (utility-style, no logos) */
    --noticeGreen:#0b6b3a;
    --noticeGold:#f5cf54;

    /* LOS accent */
    --accent1:#fbbf24;
    --accent2:#22c55e;

    --ok:#34d399;
    --err:#fb7185;
    --ring:rgba(251,191,36,.28);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(1100px 650px at 12% -10%, rgba(34,197,94,.16), transparent 60%),
      radial-gradient(950px 520px at 96% 0%, rgba(251,191,36,.14), transparent 55%),
      var(--bg);
    color:var(--text);
  }

  .wrap{
    max-width: 860px;
    margin: 0 auto;
    padding: 14px 12px 40px;
  }

  /* Header */
  .header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:12px;
  }

  .brand{
    display:flex;
    flex-direction:column;
    gap:4px;
    min-width: 0;
  }

  .brandTitle{
    font-weight:900;
    font-size:16px;
    letter-spacing:.2px;
    line-height:1.15;
  }

  .brandSub{
    color:var(--muted);
    font-size:13px;
    line-height:1.25;
  }

  .logo{
    height:44px;
    width:auto;
    border-radius:12px;
    padding:6px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    flex: 0 0 auto;
  }

  /* BIG language button */
  .langBar{
    margin: 10px 0 14px;
  }
  .langBtn{
    width:100%;
    border:none;
    border-radius:16px;
    padding:16px 14px;
    font-size:18px;
    font-weight:900;
    cursor:pointer;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    color:#06111a;
    box-shadow: 0 14px 40px rgba(0,0,0,.35);
  }
  .langBtn:active{transform: translateY(1px);}
  .langHint{
    margin-top:8px;
    text-align:center;
    color:var(--muted);
    font-size:13px;
    line-height:1.3;
  }

  /* Stacked, mobile-first layout */
  .stack{
    display:grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }

  .card{
    background: rgba(16,26,48,.92);
    border:1px solid rgba(255,255,255,.10);
    border-radius:18px;
    padding:16px;
    box-shadow: 0 18px 55px rgba(0,0,0,.45);
  }

  /* Notice */
  .notice{
    border-radius:18px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,.12);
    box-shadow: 0 18px 55px rgba(0,0,0,.45);
  }
  .noticeTop{
    background: var(--noticeGreen);
    padding:14px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .noticeTop .title{
    margin:0;
    font-size:18px;
    letter-spacing:.6px;
    text-transform:uppercase;
    font-weight:900;
  }
  .noticeTop .tag{
    font-size:12px;
    padding:7px 10px;
    border-radius:999px;
    background: rgba(255,255,255,.12);
    border:1px solid rgba(255,255,255,.16);
    color:#eafff3;
    white-space:nowrap;
    font-weight:800;
  }
  .noticeBody{
    background: var(--noticeGold);
    color:#101828;
    padding:16px;
  }
  .noticeBody p{
    margin:0 0 12px;
    line-height:1.45;
    font-size:16px;
    font-weight:700;
  }
  .noticeBody p:last-child{margin-bottom:0;}
  .noticeFooter{
    background: var(--noticeGreen);
    color:#eafff3;
    padding:14px 16px;
    font-weight:900;
    font-size:16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .noticeFooter .arrow{
    width:40px;height:40px;
    border-radius:14px;
    background: rgba(255,255,255,.12);
    border:1px solid rgba(255,255,255,.16);
    display:flex;align-items:center;justify-content:center;
    font-size:22px;
  }

  /* Bill sample */
  .sectionTitle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }
  .sectionTitle h2{
    margin:0;
    font-size:17px;
    line-height:1.2;
  }
  .pill{
    font-size:12px;
    padding:7px 10px;
    border-radius:999px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    color:var(--muted);
    font-weight:800;
  }
  .billImg{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    box-shadow: 0 16px 45px rgba(0,0,0,.45);
  }

  .explain{
    margin-top:12px;
    display:grid;
    gap:10px;
  }
  .explainItem{
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.35);
  }
  .explainItem .k{
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:.3px;
    color:#d3ddf3;
    font-weight:900;
    margin-bottom:6px;
  }
  .explainItem .v{
    color:var(--muted);
    font-size:15px;
    line-height:1.45;
  }

  /* Form - big, easy */
  .formIntro{
    margin:0 0 10px;
    color:var(--muted);
    font-size:14px;
    line-height:1.45;
  }
  label{
    display:block;
    margin:12px 0 6px;
    font-size:13px;
    color:#d3ddf3;
    font-weight:800;
  }
  input, select{
    width:100%;
    padding:14px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:#0b1428;
    color:#fff;
    font-size:16px; /* prevents iOS zoom */
    outline:none;
  }
  input:focus, select:focus{
    box-shadow: 0 0 0 4px var(--ring);
    border-color: rgba(251,191,36,.55);
  }
  .row2{
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
  }
  @media (min-width: 720px){
    .row2{grid-template-columns: 1fr 1fr;}
  }

  .consent{
    display:flex;
    gap:10px;
    align-items:flex-start;
    margin-top:14px;
    color:var(--muted);
    font-size:13px;
    line-height:1.35;
  }
  .consent input{
    width:20px;height:20px;margin-top:2px;
  }

  .btn{
    width:100%;
    padding:16px 14px;
    border:none;
    border-radius:16px;
    font-size:18px;
    font-weight:900;
    color:#06111a;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    cursor:pointer;
    margin-top:14px;
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}

  .status{
    display:none;
    margin-top:12px;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.06);
    font-size:14px;
    line-height:1.35;
  }
  .status.ok{border-color: rgba(52,211,153,.35); color:#bdf7d3;}
  .status.err{border-color: rgba(251,113,133,.45); color:#ffd6dc;}

  .disclaimer{
    margin-top:12px;
    color:#9fb2cc;
    font-size:12px;
    line-height:1.35;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="brandTitle" data-i18n="header_title">Eligibility Request • Net Billing (NEM 3.0)</div>
        <div class="brandSub" data-i18n="header_sub">Information request + bill review • Homeowners • Southern California</div>
      </div>
      <img src="los-logo.jpg" class="logo" alt="Leverage Our Sun">
    </div>

    <!-- BIG language button -->
    <div class="langBar">
      <button class="langBtn" id="langBtn" type="button" aria-label="Translate to Spanish">
        <span id="langBtnText">ESPAÑOL — TOQUE AQUÍ PARA TRADUCIR</span>
      </button>
      <div class="langHint" id="langHint" data-i18n="lang_hint">
        Tap the button to switch between English and Spanish.
      </div>
    </div>

    <div class="stack">
      <!-- Notice -->
      <div class="notice">
        <div class="noticeTop">
          <div class="title" data-i18n="notice_title">NOTICE</div>
          <div class="tag" data-i18n="notice_tag">EDISON CUSTOMERS</div>
        </div>

        <div class="noticeBody">
          <p data-i18n="notice_p1">
            Due to wildfire-related infrastructure upgrades, utilities are investing in transmission and delivery systems
            to reduce fire risk and improve reliability.
          </p>
          <p data-i18n="notice_p2">
            State and federal incentives may help qualified homeowners adopt self-generation options (solar + battery)
            to reduce reliance on the grid.
          </p>
          <p data-i18n="notice_p3">
            Under California’s newer billing rules, many homes see the highest costs during evening peak hours.
            Programs and eligibility vary by home, usage, and rate plan.
          </p>
          <p data-i18n="notice_p4">
            Assessments are being scheduled this week to determine eligibility and next steps.
          </p>
          <p data-i18n="notice_p5">
            For questions regarding eligibility, fill out the form below.
          </p>
        </div>

        <div class="noticeFooter">
          <div data-i18n="notice_footer">Contact us • Eligibility request form</div>
          <div class="arrow">›</div>
        </div>
      </div>

      <!-- Bill sample + explanation -->
      <div class="card">
        <div class="sectionTitle">
          <h2 data-i18n="bill_title">Sample Edison bill (blurred) + what it means under NEM 3.0</h2>
          <span class="pill" data-i18n="bill_pill">Example only</span>
        </div>

        <img src="bill-sample-blurred.jpg" class="billImg" alt="Blurred sample Edison bill">

        <div class="explain">
          <div class="explainItem">
            <div class="k" data-i18n="exp1_k">NEM 3.0 is “Net Billing”</div>
            <div class="v" data-i18n="exp1_v">
              With Net Billing (NBT), power you export to the grid is credited by time. Daytime export credits
              are often lower than older NEM rules. Savings usually improve when paired with battery storage.
            </div>
          </div>

          <div class="explainItem">
            <div class="k" data-i18n="exp2_k">Peak hours matter</div>
            <div class="v" data-i18n="exp2_v">
              Costs tend to be highest in the late afternoon/evening (often around 4–9 PM depending on your rate).
              Batteries can store solar energy for evening use instead of buying expensive peak power.
            </div>
          </div>

          <div class="explainItem">
            <div class="k" data-i18n="exp3_k">What we review from your bill</div>
            <div class="v" data-i18n="exp3_v">
              We review: monthly kWh usage, rate plan, peak vs off-peak use, total charges, and whether solar/battery
              can shift usage away from peak pricing under Net Billing.
            </div>
          </div>
        </div>

        <div class="disclaimer" data-i18n="disclaimer1">
          Disclaimer: This page is for informational purposes and is not affiliated with, endorsed by, or representing any utility.
        </div>
      </div>

      <!-- Form -->
      <div class="card">
        <div class="sectionTitle">
          <h2 data-i18n="form_title">Eligibility request form</h2>
          <span class="pill" data-i18n="form_pill">30–60 seconds</span>
        </div>

        <p class="formIntro" data-i18n="form_intro">
          Submit your info for a quick review. We’ll confirm next steps and whether a solar + battery plan makes sense under Net Billing (NEM 3.0).
        </p>

        <form id="leadForm" autocomplete="on">
          <!-- spam trap -->
          <input type="text" name="company" id="company" style="position:absolute;left:-9999px;opacity:0" tabindex="-1" autocomplete="off">

          <label for="name" data-i18n="lbl_name">Full name</label>
          <input id="name" name="name" required placeholder="First Last">

          <div class="row2">
            <div>
              <label for="phone" data-i18n="lbl_phone">Phone number</label>
              <input id="phone" name="phone" required placeholder="(951) 555-1234">
            </div>
            <div>
              <label for="email" data-i18n="lbl_email">Email</label>
              <input id="email" name="email" required type="email" placeholder="you@email.com">
            </div>
          </div>

          <label for="address" data-i18n="lbl_address">Home address</label>
          <input id="address" name="address" required placeholder="123 Main St, City, CA">

          <label for="avg_bill" data-i18n="lbl_bill">Average monthly electric bill</label>
          <input id="avg_bill" name="avg_bill" required placeholder="$250">

          <div class="row2">
            <div>
              <label for="homeowner" data-i18n="lbl_homeowner">Are you the homeowner?</label>
              <select id="homeowner" name="homeowner" required>
                <option value="" data-i18n="opt_select">Select</option>
                <option value="Yes" data-i18n="opt_yes">Yes</option>
                <option value="No" data-i18n="opt_no">No</option>
              </select>
            </div>

            <div>
              <label for="credit_650" data-i18n="lbl_credit">Credit above 650?</label>
              <select id="credit_650" name="credit_650" required>
                <option value="" data-i18n="opt_select">Select</option>
                <option value="Yes" data-i18n="opt_yes">Yes</option>
                <option value="No" data-i18n="opt_no">No</option>
                <option value="Not sure" data-i18n="opt_not_sure">Not sure</option>
              </select>
            </div>
          </div>

          <div class="row2">
            <div>
              <label for="ev" data-i18n="lbl_ev">Electric vehicle?</label>
              <select id="ev" name="ev" required>
                <option value="" data-i18n="opt_select">Select</option>
                <option value="Yes" data-i18n="opt_yes">Yes</option>
                <option value="No" data-i18n="opt_no">No</option>
                <option value="Planning soon" data-i18n="opt_planning">Planning soon</option>
              </select>
            </div>

            <div>
              <label for="has_solar" data-i18n="lbl_solar">Home already has solar?</label>
              <select id="has_solar" name="has_solar" required>
                <option value="" data-i18n="opt_select">Select</option>
                <option value="Yes" data-i18n="opt_yes">Yes</option>
                <option value="No" data-i18n="opt_no">No</option>
                <option value="Not sure" data-i18n="opt_not_sure">Not sure</option>
              </select>
            </div>
          </div>

          <div class="consent">
            <input type="checkbox" id="consent" required>
            <label for="consent" data-i18n="consent">
              I agree to be contacted by call/text about my eligibility request. Msg & data rates may apply. Reply STOP to opt out.
            </label>
          </div>

          <button class="btn" id="submitBtn" type="submit" data-i18n="submit_btn">Submit eligibility request</button>
          <div id="status" class="status"></div>

          <div class="disclaimer" data-i18n="disclaimer2">
            We do not sell your information. This is an eligibility request only; final options depend on site conditions and utility rate details.
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // === REQUIRED: paste your Supabase values ===
    const SUPABASE_URL = "https://YOUR_PROJECT_REF.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";
    const EDGE_FUNCTION_URL = SUPABASE_URL + "/functions/v1/send-lead-text";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById("leadForm");
    const statusDiv = document.getElementById("status");
    const btn = document.getElementById("submitBtn");

    function setStatus(type, msg){
      statusDiv.style.display = "block";
      statusDiv.className = "status " + (type || "");
      statusDiv.textContent = msg;
    }

    // === Language toggle (English <-> Spanish) ===
    let currentLang = "en";

    const i18n = {
      en: {
        header_title: "Eligibility Request • Net Billing (NEM 3.0)",
        header_sub: "Information request + bill review • Homeowners • Southern California",
        lang_hint: "Tap the button to switch between English and Spanish.",

        notice_title: "NOTICE",
        notice_tag: "EDISON CUSTOMERS",
        notice_p1: "Due to wildfire-related infrastructure upgrades, utilities are investing in transmission and delivery systems to reduce fire risk and improve reliability.",
        notice_p2: "State and federal incentives may help qualified homeowners adopt self-generation options (solar + battery) to reduce reliance on the grid.",
        notice_p3: "Under California’s newer billing rules, many homes see the highest costs during evening peak hours. Programs and eligibility vary by home, usage, and rate plan.",
        notice_p4: "Assessments are being scheduled this week to determine eligibility and next steps.",
        notice_p5: "For questions regarding eligibility, fill out the form below.",
        notice_footer: "Contact us • Eligibility request form",

        bill_title: "Sample Edison bill (blurred) + what it means under NEM 3.0",
        bill_pill: "Example only",

        exp1_k: "NEM 3.0 is “Net Billing”",
        exp1_v: "With Net Billing (NBT), power you export to the grid is credited by time. Daytime export credits are often lower than older NEM rules. Savings usually improve when paired with battery storage.",
        exp2_k: "Peak hours matter",
        exp2_v: "Costs tend to be highest in the late afternoon/evening (often around 4–9 PM depending on your rate). Batteries can store solar energy for evening use instead of buying expensive peak power.",
        exp3_k: "What we review from your bill",
        exp3_v: "We review: monthly kWh usage, rate plan, peak vs off-peak use, total charges, and whether solar/battery can shift usage away from peak pricing under Net Billing.",

        disclaimer1: "Disclaimer: This page is for informational purposes and is not affiliated with, endorsed by, or representing any utility.",

        form_title: "Eligibility request form",
        form_pill: "30–60 seconds",
        form_intro: "Submit your info for a quick review. We’ll confirm next steps and whether a solar + battery plan makes sense under Net Billing (NEM 3.0).",

        lbl_name: "Full name",
        lbl_phone: "Phone number",
        lbl_email: "Email",
        lbl_address: "Home address",
        lbl_bill: "Average monthly electric bill",
        lbl_homeowner: "Are you the homeowner?",
        lbl_credit: "Credit above 650?",
        lbl_ev: "Electric vehicle?",
        lbl_solar: "Home already has solar?",

        opt_select: "Select",
        opt_yes: "Yes",
        opt_no: "No",
        opt_not_sure: "Not sure",
        opt_planning: "Planning soon",

        consent: "I agree to be contacted by call/text about my eligibility request. Msg & data rates may apply. Reply STOP to opt out.",
        submit_btn: "Submit eligibility request",

        disclaimer2: "We do not sell your information. This is an eligibility request only; final options depend on site conditions and utility rate details.",

        status_submitting: "Submitting...",
        status_homeowner: "This request is for homeowners. Please have the homeowner submit the form.",
        status_ok: "Submitted! We received your request and will reach out shortly.",
        status_err: "Something went wrong. Please try again."
      },

      es: {
        header_title: "Solicitud de elegibilidad • Facturación Neta (NEM 3.0)",
        header_sub: "Solicitud de información + revisión de recibo • Solo propietarios • California del Sur",
        lang_hint: "Toque el botón para cambiar entre inglés y español.",

        notice_title: "AVISO",
        notice_tag: "CLIENTES DE EDISON",
        notice_p1: "Debido a mejoras de infraestructura relacionadas con incendios, las compañías eléctricas están invirtiendo en sistemas de transmisión y distribución para reducir el riesgo y mejorar la confiabilidad.",
        notice_p2: "Incentivos estatales y federales pueden ayudar a propietarios que califiquen a adoptar opciones de autogeneración (solar + batería) para reducir la dependencia de la red.",
        notice_p3: "Bajo las reglas nuevas de facturación en California, muchos hogares ven los costos más altos durante horas pico en la tarde/noche. Los programas y la elegibilidad varían según el hogar, el consumo y el plan de tarifa.",
        notice_p4: "Se están programando evaluaciones esta semana para determinar elegibilidad y próximos pasos.",
        notice_p5: "Si tiene preguntas sobre elegibilidad, complete el formulario a continuación.",
        notice_footer: "Contáctenos • Formulario de elegibilidad",

        bill_title: "Recibo de Edison (ejemplo borroso) + qué significa bajo NEM 3.0",
        bill_pill: "Solo ejemplo",

        exp1_k: "NEM 3.0 es “Facturación Neta”",
        exp1_v: "Con la Facturación Neta (NBT), la energía que exporta a la red se acredita según la hora. Los créditos por exportación durante el día suelen ser más bajos que en reglas anteriores. Los ahorros normalmente mejoran cuando se combina con una batería.",
        exp2_k: "Las horas pico importan",
        exp2_v: "Los costos suelen ser más altos en la tarde/noche (a menudo 4–9 PM según su tarifa). Las baterías pueden guardar energía solar para usarla en la noche en lugar de comprar energía cara en horas pico.",
        exp3_k: "Qué revisamos en su recibo",
        exp3_v: "Revisamos: consumo mensual (kWh), plan de tarifa, uso en pico vs fuera de pico, cargos totales y si solar/batería puede mover el uso fuera de horas caras bajo Facturación Neta.",

        disclaimer1: "Aviso: Esta página es solo informativa y no está afiliada, respaldada ni representa a ninguna compañía eléctrica.",

        form_title: "Formulario de elegibilidad",
        form_pill: "30–60 segundos",
        form_intro: "Envíe su información para una revisión rápida. Confirmaremos los próximos pasos y si un plan de solar + batería tiene sentido bajo Facturación Neta (NEM 3.0).",

        lbl_name: "Nombre completo",
        lbl_phone: "Número de teléfono",
        lbl_email: "Correo electrónico",
        lbl_address: "Dirección de la casa",
        lbl_bill: "Promedio del recibo mensual",
        lbl_homeowner: "¿Es usted el propietario?",
        lbl_credit: "¿Crédito arriba de 650?",
        lbl_ev: "¿Vehículo eléctrico?",
        lbl_solar: "¿La casa ya tiene solar?",

        opt_select: "Seleccione",
        opt_yes: "Sí",
        opt_no: "No",
        opt_not_sure: "No estoy seguro",
        opt_planning: "Pronto",

        consent: "Acepto ser contactado por llamada/texto sobre mi solicitud. Pueden aplicar cargos. Responda STOP para cancelar.",
        submit_btn: "Enviar solicitud",

        disclaimer2: "No vendemos su información. Esto es solo una solicitud; las opciones finales dependen de las condiciones del hogar y la tarifa.",

        status_submitting: "Enviando...",
        status_homeowner: "Esta solicitud es solo para propietarios. Por favor, pida al propietario que complete el formulario.",
        status_ok: "¡Enviado! Recibimos su solicitud y le contactaremos pronto.",
        status_err: "Algo salió mal. Inténtelo de nuevo."
      }
    };

    function applyLang(lang){
      currentLang = lang;
      document.documentElement.lang = lang;

      // Update all elements with data-i18n
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (i18n[lang][key]) el.textContent = i18n[lang][key];
      });

      // Update big button text
      const btnText = document.getElementById("langBtnText");
      if (lang === "en") {
        btnText.textContent = "ESPAÑOL — TOQUE AQUÍ PARA TRADUCIR";
      } else {
        btnText.textContent = "ENGLISH — TAP HERE TO TRANSLATE";
      }

      // Update placeholders (keep simple)
      document.getElementById("name").placeholder   = (lang === "es") ? "Nombre y apellido" : "First Last";
      document.getElementById("phone").placeholder  = (lang === "es") ? "(951) 555-1234" : "(951) 555-1234";
      document.getElementById("email").placeholder  = (lang === "es") ? "tucorreo@email.com" : "you@email.com";
      document.getElementById("address").placeholder= (lang === "es") ? "123 Main St, Ciudad, CA" : "123 Main St, City, CA";
      document.getElementById("avg_bill").placeholder= (lang === "es") ? "$250" : "$250";
    }

    document.getElementById("langBtn").addEventListener("click", () => {
      applyLang(currentLang === "en" ? "es" : "en");
    });

    // default
    applyLang("en");

    // === Form submit ===
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Honeypot
      const hp = document.getElementById("company").value;
      if (hp && hp.length > 0) return;

      btn.disabled = true;
      setStatus("", i18n[currentLang].status_submitting);

      const data = Object.fromEntries(new FormData(form).entries());

      if (data.homeowner === "No") {
        btn.disabled = false;
        setStatus("err", i18n[currentLang].status_homeowner);
        return;
      }

      try {
        const { error } = await supabaseClient
          .from("leads")
          .insert([{
            name: data.name,
            email: data.email,
            phone: data.phone,
            address: data.address,
            avg_bill: data.avg_bill,
            homeowner: data.homeowner,
            credit_650: data.credit_650,
            ev: data.ev,
            has_solar: data.has_solar,
            lang: currentLang
          }]);

        if (error) throw error;

        // Optional: notify you via Edge Function (Twilio)
        try {
          await fetch(EDGE_FUNCTION_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer " + SUPABASE_ANON_KEY
            },
            body: JSON.stringify({
              name: data.name,
              email: data.email,
              phone: data.phone,
              address: data.address,
              avg_bill: data.avg_bill,
              homeowner: data.homeowner,
              credit_650: data.credit_650,
              ev: data.ev,
              has_solar: data.has_solar,
              lang: currentLang
            })
          });
        } catch (_) {}

        setStatus("ok", i18n[currentLang].status_ok);
        form.reset();
      } catch (err) {
        console.error(err);
        setStatus("err", i18n[currentLang].status_err);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
