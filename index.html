<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Important Utility Notice</title>

<style>
  :root{
    --bg:#000;
    --card:#1c1c1e;
    --card2:#2c2c2e;
    --text:#fff;
    --muted:#8e8e93;

    --blue:#0a84ff;
    --green:#30d158;
    --red:#ff453a;
    --orange:#ff9f0a;

    --shadow: 0 14px 50px rgba(0,0,0,.55);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui,Roboto,Arial,sans-serif;
    background: radial-gradient(900px 500px at 20% -10%, rgba(48,209,88,.12), transparent 60%),
                radial-gradient(900px 500px at 90% 0%, rgba(10,132,255,.12), transparent 60%),
                var(--bg);
    color:var(--text);
  }

  .container{
    max-width:560px;
    margin:0 auto;
    padding:18px 14px 60px;
  }

  /* Subtle iOS-ish entrance */
  .fadeUp{
    opacity:0;
    transform: translateY(10px);
    animation: fadeUp .45s ease-out forwards;
  }
  .fadeUp.d1{animation-delay:.05s}
  .fadeUp.d2{animation-delay:.12s}
  .fadeUp.d3{animation-delay:.18s}
  .fadeUp.d4{animation-delay:.24s}
  @keyframes fadeUp{
    to{opacity:1; transform:translateY(0);}
  }

  /* Header */
  .header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
  }
  .headerLeft{
    min-width:0;
  }
  .headerTitle{
    font-weight:900;
    font-size:15px;
    letter-spacing:.2px;
    line-height:1.2;
  }
  .headerSub{
    margin-top:4px;
    color:var(--muted);
    font-size:13px;
    line-height:1.25;
  }
  .logo{
    height:40px;
    width:auto;
    border-radius:10px;
    padding:6px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    flex:0 0 auto;
  }

  /* Spanish toggle (VERY visible) */
  .langBtn{
    width:100%;
    background: var(--blue);
    color: #fff;
    font-weight:900;
    font-size:18px;
    padding:16px 14px;
    border:none;
    border-radius:18px;
    box-shadow: var(--shadow);
    cursor:pointer;
  }
  .langBtn:active{transform: translateY(1px);}
  .langHint{
    margin:8px 0 14px;
    text-align:center;
    color:var(--muted);
    font-size:13px;
    line-height:1.3;
  }

  /* Alert Card */
  .alertCard{
    background: var(--card);
    border-radius:22px;
    padding:18px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,.08);
  }
  .alertTitle{
    font-size:22px;
    font-weight:1000;
    letter-spacing:.2px;
    margin:0 0 10px;
  }
  .badgeRow{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:10px 0 12px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:9px 12px;
    border-radius:999px;
    font-size:13px;
    font-weight:900;
    background: rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.10);
    color:#f2f2f7;
  }
  .badge.red{background: rgba(255,69,58,.18); border-color: rgba(255,69,58,.28);}
  .badge.orange{background: rgba(255,159,10,.18); border-color: rgba(255,159,10,.28);}
  .badge.green{background: rgba(48,209,88,.16); border-color: rgba(48,209,88,.24);}

  .alertText{
    font-size:17px;
    line-height:1.5;
    margin:0 0 10px;
    color:#f2f2f7;
  }

  .mustReadBox{
    margin-top:12px;
    border-radius:18px;
    padding:14px;
    background: rgba(255,69,58,.12);
    border: 1px solid rgba(255,69,58,.28);
    font-weight:900;
    font-size:15px;
    line-height:1.35;
  }

  .primaryBtn{
    width:100%;
    padding:16px;
    border:none;
    border-radius:18px;
    font-size:18px;
    font-weight:1000;
    background: var(--green);
    color:#041106;
    cursor:pointer;
    margin-top:14px;
  }
  .primaryBtn:active{transform: translateY(1px);}

  .secondaryBtn{
    width:100%;
    padding:14px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.10);
    font-size:16px;
    font-weight:800;
    background: var(--card2);
    color: #fff;
    cursor:pointer;
    margin-top:10px;
  }
  .secondaryBtn:active{transform: translateY(1px);}

  /* Big savings */
  .bigSavings{
    margin-top:14px;
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.08);
    padding:18px;
    border-radius:22px;
    box-shadow: var(--shadow);
    text-align:center;
  }
  .bigLabel{
    color:var(--muted);
    font-weight:900;
    font-size:14px;
    letter-spacing:.2px;
  }
  .bigAmount{
    font-size:76px;
    font-weight:1100;
    color: var(--green);
    margin:8px 0 6px;
    line-height:1;
  }
  .bigSub{
    font-size:17px;
    font-weight:800;
    line-height:1.35;
    margin:0;
    color:#f2f2f7;
  }
  .guarantee{
    margin-top:12px;
    background: rgba(255,69,58,.12);
    border:1px solid rgba(255,69,58,.28);
    border-radius:18px;
    padding:14px;
    font-size:15px;
    font-weight:1000;
    line-height:1.35;
    color:#fff;
  }

  /* Bill */
  .billWrap{
    margin-top:14px;
    background: var(--card);
    border-radius:22px;
    padding:14px;
    box-shadow: var(--shadow);
    border:1px solid rgba(255,255,255,.08);
  }
  .billTitleRow{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }
  .billTitle{
    font-size:16px;
    font-weight:1000;
    margin:0;
    line-height:1.25;
  }
  .pill{
    font-size:12px;
    font-weight:900;
    padding:8px 10px;
    border-radius:999px;
    background: rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.10);
    color: var(--muted);
    white-space:nowrap;
    flex:0 0 auto;
  }
  .billImg{
    width:100%;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.08);
    display:block;
  }

  .threeSteps{
    margin-top:12px;
    display:grid;
    gap:10px;
  }
  .step{
    display:flex;
    gap:12px;
    align-items:flex-start;
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    padding:12px;
  }
  .stepNum{
    width:38px;height:38px;
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:1100;
    background: linear-gradient(90deg, var(--blue), var(--green));
    color:#031018;
    flex:0 0 auto;
    font-size:18px;
  }
  .stepTitle{
    font-weight:1000;
    font-size:16px;
    line-height:1.25;
    margin:0 0 4px;
  }
  .stepText{
    margin:0;
    color:#d1d1d6;
    font-size:15px;
    line-height:1.45;
    font-weight:700;
  }

  /* Form */
  .formCard{
    margin-top:14px;
    background: var(--card);
    padding:18px;
    border-radius:22px;
    box-shadow: var(--shadow);
    border:1px solid rgba(255,255,255,.08);
  }
  .formTitle{
    font-size:20px;
    font-weight:1100;
    margin:0 0 10px;
  }
  .formIntro{
    margin:0 0 12px;
    color:var(--muted);
    font-size:14px;
    line-height:1.35;
    font-weight:700;
  }

  label{
    display:block;
    font-size:14px;
    font-weight:900;
    margin-top:12px;
    color:#f2f2f7;
  }
  input, select{
    width:100%;
    padding:14px;
    margin-top:6px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.10);
    font-size:16px; /* prevents iOS zoom */
    background: var(--card2);
    color: var(--text);
    outline:none;
  }
  input:focus, select:focus{
    border-color: rgba(10,132,255,.55);
    box-shadow: 0 0 0 4px rgba(10,132,255,.18);
  }

  .row2{
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
  }
  @media (min-width: 520px){
    .row2{grid-template-columns:1fr 1fr;}
  }

  .consentRow{
    display:flex;
    gap:10px;
    align-items:flex-start;
    margin-top:14px;
    padding:12px;
    border-radius:18px;
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
  }
  .consentRow input{
    width:20px;height:20px;margin-top:2px;
  }
  .consentText{
    color:#d1d1d6;
    font-size:13px;
    line-height:1.35;
    font-weight:700;
  }

  .submitBtn{
    width:100%;
    margin-top:16px;
    padding:18px;
    border:none;
    border-radius:18px;
    font-size:18px;
    font-weight:1100;
    background: var(--blue);
    color:#fff;
    cursor:pointer;
  }
  .submitBtn:disabled{opacity:.65; cursor:not-allowed;}
  .status{
    margin-top:12px;
    padding:12px;
    border-radius:18px;
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    color:#f2f2f7;
    font-size:14px;
    line-height:1.35;
    font-weight:700;
    display:none;
  }
  .status.ok{border-color: rgba(48,209,88,.28); background: rgba(48,209,88,.10);}
  .status.err{border-color: rgba(255,69,58,.28); background: rgba(255,69,58,.10);}

  .disclaimer{
    margin-top:12px;
    color:var(--muted);
    font-size:12px;
    line-height:1.35;
    font-weight:700;
  }

  /* Success screen */
  .successCard{
    display:none;
    margin-top:14px;
    background: var(--card);
    padding:18px;
    border-radius:22px;
    box-shadow: var(--shadow);
    border:1px solid rgba(255,255,255,.08);
    text-align:center;
  }
  .check{
    width:64px;height:64px;
    border-radius:22px;
    margin: 4px auto 10px;
    background: rgba(48,209,88,.18);
    border:1px solid rgba(48,209,88,.28);
    display:flex;align-items:center;justify-content:center;
    font-size:34px;
  }
  .successTitle{
    font-weight:1100;
    font-size:20px;
    margin:0 0 8px;
  }
  .successText{
    margin:0;
    color:#d1d1d6;
    font-size:15px;
    line-height:1.45;
    font-weight:700;
  }

  /* Modal (in-page window) */
  .modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.86);
    z-index:9999;
    padding:10px;
  }
  .modalContent{
    height:100%;
    width:100%;
    max-width:980px;
    margin: 0 auto;
    background:#fff;
    border-radius:18px;
    overflow:hidden;
    position:relative;
  }
  .modalHeader{
    position:absolute;
    top:10px; left:10px; right:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    z-index:2;
    pointer-events:none;
  }
  .modalTitle{
    pointer-events:none;
    background: rgba(0,0,0,.70);
    color:#fff;
    padding:8px 10px;
    border-radius:12px;
    font-weight:900;
    font-size:13px;
    max-width:70%;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }
  .closeBtn{
    pointer-events:auto;
    background: rgba(0,0,0,.82);
    color:#fff;
    border:none;
    padding:10px 12px;
    border-radius:12px;
    font-weight:1000;
    cursor:pointer;
  }
  iframe{
    width:100%;
    height:100%;
    border:none;
  }

  /* Scroll target */
  #formSection{scroll-margin-top: 14px;}
</style>
</head>

<body>
<div class="container">

  <div class="header fadeUp d1">
    <div class="headerLeft">
      <div class="headerTitle" data-i18n="header_title">Important Utility Information</div>
      <div class="headerSub" data-i18n="header_sub">Homeowners • Bill review • Qualification required</div>
    </div>
    <img src="los-logo.jpg" class="logo" alt="Leverage Our Sun">
  </div>

  <button class="langBtn fadeUp d2" id="langBtn" type="button">
    <span id="langBtnText">ESPAÑOL — TOQUE AQUÍ PARA LEER EN ESPAÑOL</span>
  </button>
  <div class="langHint fadeUp d2" data-i18n="lang_hint">Tap to switch between English and Spanish.</div>

  <div class="alertCard fadeUp d3">
    <div class="alertTitle" data-i18n="alert_title">⚠️ MUST READ — EDISON CUSTOMERS</div>

    <div class="badgeRow">
      <div class="badge red" data-i18n="badge_important">IMPORTANT</div>
      <div class="badge orange" data-i18n="badge_rates">RATES UPDATED</div>
      <div class="badge green" data-i18n="badge_qual">QUALIFICATION REQUIRED</div>
    </div>

    <p class="alertText" data-i18n="alert_p1">
      Under California’s Net Billing rules (NEM 3.0), savings depend on reducing expensive peak-hour electricity purchases.
    </p>
    <p class="alertText" data-i18n="alert_p2">
      We review your bill to determine whether a solar + battery plan can lower your total electricity cost.
    </p>

    <div class="mustReadBox" data-i18n="must_read">
      We only move forward if savings can be guaranteed from Day 1. If we can’t guarantee savings, you won’t be selected.
    </div>

    <button class="primaryBtn" id="toFormBtn" type="button" data-i18n="check_btn">
      Check Eligibility (Go to Form)
    </button>

    <button class="secondaryBtn" type="button"
      onclick="openModal('Edison 13% Rate Update','https://www.sce.com/save-money/rates-financing/residential-rate-plans/understanding-updates-to-your-bill')"
      data-i18n="rate_btn">
      View Edison 13% Rate Update
    </button>

    <button class="secondaryBtn" type="button"
      onclick="openModal('Pasadena Now Article','https://pasadenanow.com/main/edison-has-extended-500-offers-worth-165-million-through-eaton-compensation-program-survivors-group-calls-payouts-inadequate')"
      data-i18n="article_btn">
      View Pasadena Article
    </button>
  </div>

  <div class="bigSavings fadeUp d4">
    <div class="bigLabel" data-i18n="july_label">July (Summer) Real Example</div>
    <div class="bigAmount"><span aria-hidden="true">$</span><span data-i18n="july_amount">28</span></div>
    <p class="bigSub" data-i18n="july_sub">Total electric cost for the month (sample bill shown below)</p>
    <div class="guarantee" data-i18n="guarantee">
      If savings cannot be guaranteed from Day 1, the program is not offered.
    </div>
  </div>

  <div class="billWrap fadeUp d4">
    <div class="billTitleRow">
      <h2 class="billTitle" data-i18n="bill_title">Sample Bill (for reference)</h2>
      <div class="pill" data-i18n="bill_pill">Example</div>
    </div>

    <!-- Unblurred bill image file in repo root -->
    <img src="bill-sample.jpg" class="billImg" alt="Sample bill image">

    <div class="threeSteps" aria-label="How it works">
      <div class="step">
        <div class="stepNum">1</div>
        <div>
          <p class="stepTitle" data-i18n="s1_title">Peak-hours are the problem</p>
          <p class="stepText" data-i18n="s1_text">
            Under NEM 3.0 (Net Billing), the goal is to avoid buying expensive peak electricity when rates are highest.
          </p>
        </div>
      </div>
      <div class="step">
        <div class="stepNum">2</div>
        <div>
          <p class="stepTitle" data-i18n="s2_title">Battery changes the outcome</p>
          <p class="stepText" data-i18n="s2_text">
            A battery stores energy so the home can use it later—especially during evening peak hours—helping reduce total cost.
          </p>
        </div>
      </div>
      <div class="step">
        <div class="stepNum">3</div>
        <div>
          <p class="stepTitle" data-i18n="s3_title">No Day-1 savings = no program</p>
          <p class="stepText" data-i18n="s3_text">
            If we can’t show savings up front based on your bill and usage, we don’t move forward. Qualification & selection required.
          </p>
        </div>
      </div>
    </div>

    <div class="disclaimer" data-i18n="disclaimer_utility">
      Disclaimer: This page is for informational purposes and is not affiliated with, endorsed by, or representing any utility.
    </div>
  </div>

  <div class="formCard fadeUp d4" id="formSection">
    <div class="formTitle" data-i18n="form_title">Eligibility Request Form</div>
    <div class="formIntro" data-i18n="form_intro">
      Fill this out and we’ll confirm whether we can guarantee Day-1 savings. If we can’t, you won’t be selected.
    </div>

    <form id="leadForm" autocomplete="on">
      <!-- simple honeypot -->
      <input type="text" name="company" id="company" style="position:absolute;left:-9999px;opacity:0" tabindex="-1" autocomplete="off">

      <div class="row2">
        <div>
          <label for="name" data-i18n="lbl_name">Full Name</label>
          <input id="name" name="name" required placeholder="First Last">
        </div>
        <div>
          <label for="phone" data-i18n="lbl_phone">Phone</label>
          <input id="phone" name="phone" required placeholder="(951) 555-1234" inputmode="tel">
        </div>
      </div>

      <div class="row2">
        <div>
          <label for="email" data-i18n="lbl_email">Email</label>
          <input id="email" name="email" required type="email" placeholder="you@email.com">
        </div>
        <div>
          <label for="avg_bill" data-i18n="lbl_bill">Average Monthly Bill</label>
          <input id="avg_bill" name="avg_bill" required placeholder="$250">
        </div>
      </div>

      <label for="address" data-i18n="lbl_address">Home Address</label>
      <input id="address" name="address" required placeholder="123 Main St, City, CA" autocomplete="street-address">

      <div class="row2">
        <div>
          <label for="homeowner" data-i18n="lbl_homeowner">Homeowner?</label>
          <select id="homeowner" name="homeowner" required>
            <option value="" data-i18n="opt_select">Select</option>
            <option value="Yes" data-i18n="opt_yes">Yes</option>
            <option value="No" data-i18n="opt_no">No</option>
          </select>
        </div>
        <div>
          <label for="credit_650" data-i18n="lbl_credit">Credit Above 650?</label>
          <select id="credit_650" name="credit_650" required>
            <option value="" data-i18n="opt_select">Select</option>
            <option value="Yes" data-i18n="opt_yes">Yes</option>
            <option value="No" data-i18n="opt_no">No</option>
            <option value="Not sure" data-i18n="opt_not_sure">Not sure</option>
          </select>
        </div>
      </div>

      <div class="row2">
        <div>
          <label for="ev" data-i18n="lbl_ev">Electric Vehicle?</label>
          <select id="ev" name="ev" required>
            <option value="" data-i18n="opt_select">Select</option>
            <option value="Yes" data-i18n="opt_yes">Yes</option>
            <option value="No" data-i18n="opt_no">No</option>
            <option value="Planning soon" data-i18n="opt_planning">Planning soon</option>
          </select>
        </div>
        <div>
          <label for="has_solar" data-i18n="lbl_solar">Home Already Has Solar?</label>
          <select id="has_solar" name="has_solar" required>
            <option value="" data-i18n="opt_select">Select</option>
            <option value="Yes" data-i18n="opt_yes">Yes</option>
            <option value="No" data-i18n="opt_no">No</option>
            <option value="Not sure" data-i18n="opt_not_sure">Not sure</option>
          </select>
        </div>
      </div>

      <div class="consentRow">
        <input type="checkbox" id="consent" required>
        <div class="consentText" data-i18n="consent">
          I agree to be contacted by call/text regarding my eligibility request. Msg & data rates may apply. Reply STOP to opt out.
        </div>
      </div>

      <button class="submitBtn" id="submitBtn" type="submit" data-i18n="submit_btn">Submit Eligibility Request</button>

      <div class="status" id="status"></div>

      <div class="disclaimer" data-i18n="disclaimer_privacy">
        We do not sell your information. This is an eligibility request only. Final options depend on the home, usage, and program availability.
      </div>
    </form>
  </div>

  <div class="successCard fadeUp" id="successCard" aria-live="polite">
    <div class="check">✓</div>
    <div class="successTitle" data-i18n="success_title">Request Received</div>
    <p class="successText" data-i18n="success_text">
      Thanks. If you qualify, we’ll contact you shortly with next steps. If we can’t guarantee savings from Day 1, we won’t move forward.
    </p>
  </div>

</div>

<!-- Modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Information window">
  <div class="modalContent">
    <div class="modalHeader">
      <div class="modalTitle" id="modalTitle">Information</div>
      <button class="closeBtn" type="button" onclick="closeModal()" data-i18n="close_btn">Close</button>
    </div>
    <iframe id="modalFrame" title="Info content"></iframe>
  </div>
</div>

<!-- Supabase (optional) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  /***************
   * CONFIG
   ***************/
  // If you want the form to store leads + trigger SMS, paste your Supabase values:
  const SUPABASE_URL = "https://YOUR_PROJECT_REF.supabase.co";
  const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";
  // Optional (Twilio via Supabase Edge Function):
  const EDGE_FUNCTION_URL = SUPABASE_URL + "/functions/v1/send-lead-text";

  const supabaseEnabled = !SUPABASE_URL.includes("YOUR_PROJECT_REF") && !SUPABASE_ANON_KEY.includes("YOUR_ANON_KEY");
  const supabaseClient = supabaseEnabled ? supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

  /***************
   * i18n
   ***************/
  let currentLang = "en";
  const i18n = {
    en: {
      header_title: "Important Utility Information",
      header_sub: "Homeowners • Bill review • Qualification required",
      lang_hint: "Tap to switch between English and Spanish.",

      alert_title: "⚠️ MUST READ — EDISON CUSTOMERS",
      badge_important: "IMPORTANT",
      badge_rates: "RATES UPDATED",
      badge_qual: "QUALIFICATION REQUIRED",
      alert_p1: "Under California’s Net Billing rules (NEM 3.0), savings depend on reducing expensive peak-hour electricity purchases.",
      alert_p2: "We review your bill to determine whether a solar + battery plan can lower your total electricity cost.",
      must_read: "We only move forward if savings can be guaranteed from Day 1. If we can’t guarantee savings, you won’t be selected.",
      check_btn: "Check Eligibility (Go to Form)",
      rate_btn: "View Edison 13% Rate Update",
      article_btn: "View Pasadena Article",

      july_label: "July (Summer) Real Example",
      july_amount: "28",
      july_sub: "Total electric cost for the month (sample bill shown below)",
      guarantee: "If savings cannot be guaranteed from Day 1, the program is not offered.",

      bill_title: "Sample Bill (for reference)",
      bill_pill: "Example",
      s1_title: "Peak-hours are the problem",
      s1_text: "Under NEM 3.0 (Net Billing), the goal is to avoid buying expensive peak electricity when rates are highest.",
      s2_title: "Battery changes the outcome",
      s2_text: "A battery stores energy so the home can use it later—especially during evening peak hours—helping reduce total cost.",
      s3_title: "No Day-1 savings = no program",
      s3_text: "If we can’t show savings up front based on your bill and usage, we don’t move forward. Qualification & selection required.",
      disclaimer_utility: "Disclaimer: This page is for informational purposes and is not affiliated with, endorsed by, or representing any utility.",

      form_title: "Eligibility Request Form",
      form_intro: "Fill this out and we’ll confirm whether we can guarantee Day-1 savings. If we can’t, you won’t be selected.",

      lbl_name: "Full Name",
      lbl_phone: "Phone",
      lbl_email: "Email",
      lbl_bill: "Average Monthly Bill",
      lbl_address: "Home Address",
      lbl_homeowner: "Homeowner?",
      lbl_credit: "Credit Above 650?",
      lbl_ev: "Electric Vehicle?",
      lbl_solar: "Home Already Has Solar?",

      opt_select: "Select",
      opt_yes: "Yes",
      opt_no: "No",
      opt_not_sure: "Not sure",
      opt_planning: "Planning soon",

      consent: "I agree to be contacted by call/text regarding my eligibility request. Msg & data rates may apply. Reply STOP to opt out.",
      submit_btn: "Submit Eligibility Request",

      disclaimer_privacy: "We do not sell your information. This is an eligibility request only. Final options depend on the home, usage, and program availability.",

      close_btn: "Close",

      status_submitting: "Submitting…",
      status_need_homeowner: "This request is for homeowners. Please have the homeowner submit the form.",
      status_saved_no_sms: "Submitted. We received your request.",
      status_error: "Something went wrong. Please try again.",

      success_title: "Request Received",
      success_text: "Thanks. If you qualify, we’ll contact you shortly with next steps. If we can’t guarantee savings from Day 1, we won’t move forward."
    },

    es: {
      header_title: "Información importante de servicios",
      header_sub: "Solo propietarios • Revisión del recibo • Se requiere calificación",
      lang_hint: "Toque para cambiar entre inglés y español.",

      alert_title: "⚠️ OBLIGATORIO LEER — CLIENTES DE EDISON",
      badge_important: "IMPORTANTE",
      badge_rates: "TARIFAS ACTUALIZADAS",
      badge_qual: "SE REQUIERE CALIFICAR",
      alert_p1: "Bajo las reglas de Facturación Neta (NEM 3.0), los ahorros dependen de reducir compras de electricidad en horas pico (más caras).",
      alert_p2: "Revisamos su recibo para determinar si un plan de solar + batería puede reducir su costo total de electricidad.",
      must_read: "Solo avanzamos si podemos garantizar ahorros desde el día 1. Si no podemos garantizar ahorros, no será seleccionado.",
      check_btn: "Verificar elegibilidad (Ir al formulario)",
      rate_btn: "Ver actualización de tarifa 13% (Edison)",
      article_btn: "Ver artículo de Pasadena",

      july_label: "Ejemplo real de julio (verano)",
      july_amount: "28",
      july_sub: "Costo total de electricidad del mes (recibo de ejemplo abajo)",
      guarantee: "Si no se pueden garantizar ahorros desde el día 1, el programa no se ofrece.",

      bill_title: "Recibo de ejemplo (referencia)",
      bill_pill: "Ejemplo",
      s1_title: "Las horas pico son el problema",
      s1_text: "Con NEM 3.0 (Facturación Neta), la meta es evitar comprar electricidad cara cuando las tarifas están más altas.",
      s2_title: "La batería cambia el resultado",
      s2_text: "La batería guarda energía para usarla después—especialmente en la tarde/noche—ayudando a reducir el costo total.",
      s3_title: "Sin ahorro día 1 = no hay programa",
      s3_text: "Si no podemos mostrar ahorros por adelantado según su recibo y consumo, no avanzamos. Se requiere calificación y selección.",
      disclaimer_utility: "Aviso: Esta página es solo informativa y no está afiliada, respaldada ni representa a ninguna compañía eléctrica.",

      form_title: "Formulario de elegibilidad",
      form_intro: "Complete esto y confirmaremos si podemos garantizar ahorros desde el día 1. Si no podemos, no será seleccionado.",

      lbl_name: "Nombre completo",
      lbl_phone: "Teléfono",
      lbl_email: "Correo electrónico",
      lbl_bill: "Promedio mensual del recibo",
      lbl_address: "Dirección de la casa",
      lbl_homeowner: "¿Es propietario?",
      lbl_credit: "¿Crédito arriba de 650?",
      lbl_ev: "¿Vehículo eléctrico?",
      lbl_solar: "¿La casa ya tiene solar?",

      opt_select: "Seleccione",
      opt_yes: "Sí",
      opt_no: "No",
      opt_not_sure: "No estoy seguro",
      opt_planning: "Pronto",

      consent: "Acepto ser contactado por llamada/texto sobre mi solicitud. Pueden aplicar cargos. Responda STOP para cancelar.",
      submit_btn: "Enviar solicitud",

      disclaimer_privacy: "No vendemos su información. Esto es solo una solicitud. Las opciones finales dependen de la casa, el consumo y la disponibilidad del programa.",

      close_btn: "Cerrar",

      status_submitting: "Enviando…",
      status_need_homeowner: "Esta solicitud es solo para propietarios. Pida al propietario que complete el formulario.",
      status_saved_no_sms: "Enviado. Recibimos su solicitud.",
      status_error: "Algo salió mal. Inténtelo de nuevo.",

      success_title: "Solicitud recibida",
      success_text: "Gracias. Si califica, le contactaremos pronto con los próximos pasos. Si no podemos garantizar ahorros desde el día 1, no avanzaremos."
    }
  };

  function applyLang(lang){
    currentLang = lang;
    document.documentElement.lang = lang;

    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key];
    });

    // Update big language button label
    const btnText = document.getElementById("langBtnText");
    if (lang === "en") btnText.textContent = "ESPAÑOL — TOQUE AQUÍ PARA LEER EN ESPAÑOL";
    else btnText.textContent = "ENGLISH — TAP HERE TO READ IN ENGLISH";

    // Placeholders (keep simple & readable)
    document.getElementById("name").placeholder = (lang === "es") ? "Nombre y apellido" : "First Last";
    document.getElementById("phone").placeholder = "(951) 555-1234";
    document.getElementById("email").placeholder = (lang === "es") ? "tucorreo@email.com" : "you@email.com";
    document.getElementById("avg_bill").placeholder = "$250";
    document.getElementById("address").placeholder = (lang === "es") ? "123 Main St, Ciudad, CA" : "123 Main St, City, CA";
  }

  // Auto-detect Spanish if user's device is Spanish
  const prefersSpanish = (navigator.language || "").toLowerCase().startsWith("es");
  applyLang(prefersSpanish ? "es" : "en");

  document.getElementById("langBtn").addEventListener("click", () => {
    applyLang(currentLang === "en" ? "es" : "en");
  });

  /***************
   * Scroll to form
   ***************/
  document.getElementById("toFormBtn").addEventListener("click", () => {
    document.getElementById("formSection").scrollIntoView({behavior:"smooth"});
  });

  /***************
   * Modal
   ***************/
  function openModal(title, url){
    const modal = document.getElementById("modal");
    const frame = document.getElementById("modalFrame");
    const modalTitle = document.getElementById("modalTitle");
    modalTitle.textContent = title || "Information";
    frame.src = url;
    modal.style.display = "block";
  }
  function closeModal(){
    const modal = document.getElementById("modal");
    const frame = document.getElementById("modalFrame");
    modal.style.display = "none";
    frame.src = "";
  }
  // expose for inline onclick
  window.openModal = openModal;
  window.closeModal = closeModal;

  // close modal on background tap (not required, but nice)
  document.getElementById("modal").addEventListener("click", (e) => {
    if (e.target.id === "modal") closeModal();
  });

  /***************
   * Submit -> Supabase + optional SMS -> Success screen
   ***************/
  const form = document.getElementById("leadForm");
  const statusEl = document.getElementById("status");
  const submitBtn = document.getElementById("submitBtn");
  const successCard = document.getElementById("successCard");
  const formCard = document.getElementById("formSection");

  function setStatus(type, msg){
    statusEl.style.display = "block";
    statusEl.className = "status " + (type || "");
    statusEl.textContent = msg;
  }

  function getSource(){
    const p = new URLSearchParams(window.location.search);
    return p.get("src") || p.get("source") || "";
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // honeypot
    if (document.getElementById("company").value) return;

    submitBtn.disabled = true;
    setStatus("", i18n[currentLang].status_submitting);

    const data = Object.fromEntries(new FormData(form).entries());

    if (data.homeowner === "No"){
      submitBtn.disabled = false;
      setStatus("err", i18n[currentLang].status_need_homeowner);
      return;
    }

    // Prepare payload
    const payload = {
      name: data.name,
      phone: data.phone,
      email: data.email,
      avg_bill: data.avg_bill,
      address: data.address,
      homeowner: data.homeowner,
      credit_650: data.credit_650,
      ev: data.ev,
      has_solar: data.has_solar,
      lang: currentLang,
      source: getSource(),
      created_at_client: new Date().toISOString()
    };

    try {
      if (supabaseEnabled){
        // Store lead
        const { error } = await supabaseClient.from("leads").insert([payload]);
        if (error) throw error;

        // Optional: notify you via Edge Function (Twilio). If not deployed, this will just be skipped.
        try{
          await fetch(EDGE_FUNCTION_URL, {
            method:"POST",
            headers:{
              "Content-Type":"application/json",
              "Authorization":"Bearer " + SUPABASE_ANON_KEY
            },
            body: JSON.stringify(payload)
          });
        }catch(_){}
      } else {
        // If Supabase not configured, still show success so the page works during testing.
        // (No storage happens until you paste real keys.)
      }

      // Success screen (Apple-ish)
      statusEl.style.display = "none";
      formCard.style.display = "none";
      successCard.style.display = "block";
      successCard.scrollIntoView({behavior:"smooth"});

    } catch (err) {
      console.error(err);
      setStatus("err", i18n[currentLang].status_error);
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>
